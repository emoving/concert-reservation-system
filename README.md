# 콘서트 예약 시스템
> 도메인 주도 설계(DDD)와 배치 자동화를 활용한 고가용성 예약 서비스

## 1. 프로젝트 개요
* 기간: 2024.06 ~ 2024.08
* 역할: 백엔드 개발 (1인 프로젝트)
* 핵심 목표: 애그리거트 기반의 견고한 도메인 설계 및 배치 처리를 통한 예약 생명주기 관리
* 핵심 키워드: DDD (Aggregate), Optimistic Lock, Scheduler, Spring Events, Global Exception Handling
* 주요 기능: 토큰 기반 대기열, 좌석 선점 예약, 미결제 예약 자동 취소 및 자원 복구

### 2. 기술 스택
* Backend: Java, Spring Boot, Spring Data JPA
* Storage: MySQL, Redis
* Scheduling: Spring Scheduler
* Common: Spring Interceptor, ControllerAdvice

### 3. 시스템 아키텍처 및 데이터 설계 (ERD)
![ERD](/docs/ERD.png)
* 도메인 분리 및 데이터 관계 설계
    * 사용자 및 잔액: 사용자의 잔액 변화를 이력으로 관리하여 데이터 추적성 확보
    * 대기열 토큰: 사용자와 1:1 관계를 맺으며 활성 및 대기 상태를 통해 트래픽 제어
    * 콘서트 정보: 계층적 구조 설계를 통해 콘서트별 회차 및 좌석 정보를 체계적으로 관리
    * 예약 및 결제: 예약 상태(reserved, payed, expired)를 기반으로 결제 데이터와 연계하여 생명주기 관리

### 4. 핵심 기술적 해결 과제
* 도메인 주도 설계(DDD) 및 애그리거트 기반 구조화
    * 콘서트, 회차, 좌석 로직을 하나의 애그리거트 단위로 캡슐화하여 비즈니스 규칙의 응집도 향상
    * 도메인 모델 내부로 핵심 로직을 이동시켜 서비스 레이어의 비대화를 방지하고 코드 가독성 증대

* 스케줄러 기반 자원 자동화 및 대기열 관리
    * 대기열 갱신: Redis 토큰 상태를 주기적으로 체크하여 유효 인원을 ACTIVE로 전환하는 배치 프로세스 구축
    * 자동 예약 취소: 일정 시간 내 미결제 건을 감지하여 좌석 상태를 AVAILABLE로 복원하는 자원 회전율 최적화 로직 구현

* 낙관적 락(Optimistic Lock)을 통한 동시성 제어
    * JPA @Version 기반 낙관적 락을 적용하여 동일 좌석에 대한 중복 선점 요청을 데이터베이스 수준에서 원천 차단
    * DB Lock 오버헤드를 줄이면서도 데이터 정합성을 확보하여 높은 처리 성능 유지

* 공통 처리 및 예외 설계의 표준화
    * Global Exception Handler: @RestControllerAdvice를 통해 비즈니스 예외와 런타임 예외를 중앙 집중식으로 관리
    * ErrorResponse 설계: 에러 코드와 메시지를 포함한 표준 응답 규격을 정의하여 프론트엔드와의 협업 생산성 증대
    * Interceptor: API 요청 로깅 및 대기열 토큰 검증 로직을 인터셉터로 분리하여 횡단 관심사 해결

### 5. API 명세 (핵심 요약)
| 도메인 | 메서드 | 엔드포인트          | 설명 |
| :--- | :---: |:---------------| :--- |
| Queue | POST | /queue/token   | 대기열 진입 및 대기 토큰 발급 |
| Concert | GET | /concerts/{id} | 콘서트 및 회차별 잔여 좌석 조회 |
| Reserve | POST | /reservations  | 좌석 선점 예약 (낙관적 락 적용) |
| Payment | POST | /payments      | 결제 승인 요청 및 내부 이벤트 발행 |

### 6. 성장 포인트 및 회고
* 아키텍처 관점의 공통 로직 설계 
  인터셉터와 글로벌 예외 핸들러를 구축하며, 개별 기능 구현만큼이나 시스템 전체의 일관성과 유지보수성을 고려한 공통 기반 설계의 중요성을 깨달음
* 시스템 자동화 및 자원 관리 경험
  스케줄러를 통한 상태 관리 자동화를 경험하며, 시스템이 스스로 정합성을 유지하도록 설계하는 자가 치유 구조에 대해 깊이 고민
* 도메인 모델링 역량 강화
  복잡한 비즈니스 요구사항을 애그리거트 단위로 구조화하며, 객체지향적 설계가 코드의 가독성과 확장성에 주는 이점을 직접 체감